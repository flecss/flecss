@function flex__child-width($m) {
    @return calc((100% / (#{$m} + 0.001)) - (var(--flecss__flex-gap) * (#{$m} - 1) / #{$m}));
}


@mixin flex__shared {    
    display: flex;
    flex-wrap: wrap;
    flex-direction: row;
    align-items: flex-start;
    gap: var(--flecss__flex-gap);
    width: 100%;
    height: fit-content;
    overflow-x: hidden;
}


@mixin flex__partition($n) {
    @include class-specifier($n) {
        @include space-modifier(--flecss__flex-gap, "l") {    
            @include flex__shared;
            
            & > * {
                width: flex__child-width($n);
                
                @if $n > 4 {
                    @include flecss_breakpoint--m {
                        width: flex__child-width(4);
                    }
                }
                @if $n > 2 {
                    @include flecss_breakpoint--s {
                        width: flex__child-width(2);
                    }
                }
                @if $n > 1 {
                    @include flecss_breakpoint--xs {
                        width: flex__child-width(1);
                    }
                }
            }
        }
    }
}

@include class("flex", "f") {
    @include space-modifier(--flecss__flex-gap, "xl") {
        @include flex__shared;

        align-items: center;
        width: fit-content;
    }
    
    @include flex__partition(1);
    @include flex__partition(2);
    @include flex__partition(3);
    @include flex__partition(4);
    @include flex__partition(5);
    
    @include class-specifier("left", "l") {
        @include space-modifier(--flecss__flex-gap, "xl") {
            @include flex__shared;
            
            & > *:first-child {
                flex: 1 0 0;
                max-width: 100%;
            }

            @include flecss_breakpoint--s {
                & > * {
                    width: 100%;
                }
            }
        }
    }
    @include class-specifier("right", "r") {
        @include space-modifier(--flecss__flex-gap, "xl") {
            @include flex__shared;

            & > *:last-child {
                flex: 1 0 0;
                max-width: 100%;
            }
            
            @include flecss_breakpoint--s {
                & > * {
                    width: 100%;
                }
            }
        }
    }
}